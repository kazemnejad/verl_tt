# Copyright 2025 Treetune Authors
# Licensed under the Apache License, Version 2.0
#
# E2E test config for GenerationRunner.
# Uses small model and few samples for fast testing.

hydra:
  searchpath:
    - file://verl/trainer/config

defaults:
  - rollout@rollout: rollout
  - _self_

# === Hardware (1 GPU for E2E test) ===
n_gpus_per_node: 1
nnodes: 1

# === Model (small model for fast testing) ===
model:
  path: Qwen/Qwen2.5-0.5B-Instruct
  trust_remote_code: true

# === Rollout ===
rollout:
  name: sglang
  tensor_model_parallel_size: 1
  data_parallel_size: 1
  pipeline_model_parallel_size: 1
  gpu_memory_utilization: 0.5
  free_cache_engine: false
  # Sampling
  temperature: 0.0  # Deterministic for testing
  top_p: 1.0
  top_k: -1
  prompt_length: 512
  response_length: 32  # Short for fast tests
  calculate_log_probs: true
  # MTP disabled
  mtp:
    enable: false
  # Agent loop
  agent:
    num_workers: 1
    default_agent_loop: single_turn_agent
    agent_loop_config_path: null

# === Data ===
data:
  files: ???  # Set by test
  prompt_key: prompt
  max_samples: 5

# === Task System ===
tasks: null

# === Generation Runner ===
generation:
  output_dir: ${hydra:runtime.output_dir}/trajectories
  save_batch_size: 2
  pull_timeout: 60.0
  final_merge: true
  checkpoint_interval: 1
  show_progress: true
  wandb_upload: false
  wandb_project: null
  wandb_run_name: null

# === Project Info ===
project_name: generation_e2e_test
experiment_name: test_run
