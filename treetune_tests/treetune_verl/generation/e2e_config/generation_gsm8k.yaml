# Copyright 2025 Treetune Authors
# Licensed under the Apache License, Version 2.0
#
# E2E smoke test config for GenerationRunner with GSM8K subset.

hydra:
  searchpath:
    - file://verl/trainer/config

defaults:
  - rollout@rollout: rollout
  - _self_

# === Hardware (1 GPU for smoke test) ===
n_gpus_per_node: 1
nnodes: 1

# === Model (small model for fast testing) ===
model:
  path: Qwen/Qwen2.5-0.5B-Instruct
  trust_remote_code: true

# === Rollout ===
rollout:
  name: sglang
  tensor_model_parallel_size: 1
  data_parallel_size: 1
  pipeline_model_parallel_size: 1
  gpu_memory_utilization: 0.5
  free_cache_engine: false
  # Sampling
  temperature: 0.7
  top_p: 0.95
  top_k: -1
  prompt_length: 512
  response_length: 256
  calculate_log_probs: true
  # MTP (speculative decoding) - disable for basic test
  mtp:
    enable: false
    enable_rollout: false
  # Agent loop
  agent:
    num_workers: 2
    default_agent_loop: single_turn_agent
    agent_loop_config_path: null

# === Data (use tasks to load GSM8K) ===
data:
  files: null  # Will be set by tasks
  prompt_key: raw_prompt
  max_samples: 5  # Small subset for smoke test

# === Task System ===
tasks:
  - loading_params:
      args: ["openai/gsm8k"]
      kwargs: {name: main, split: test}
    prompt_template: "Solve this math problem:\n{question}\nAnswer:"
    data_source: "gsm8k"

# === Generation Runner ===
generation:
  output_dir: ${hydra:runtime.output_dir}/trajectories
  save_batch_size: 10
  pull_timeout: 60.0
  final_merge: true
  checkpoint_interval: 1
  show_progress: true
  wandb_upload: false
  wandb_project: null
  wandb_run_name: null

# === Project Info ===
project_name: generation_e2e
experiment_name: smoke_test
